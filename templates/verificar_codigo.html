{% extends "base.html" %} 
{% block title %}Verificar C√≥digo{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="card shadow-sm border-0 rounded-3">
    <div class="card-header bg-primary text-white">
      <h4 class="mb-0">üîé Verificar C√≥digo de Refer√™ncia</h4>
    </div>

    <div class="card-body">
      <form method="POST" class="row g-3 align-items-end">
        <div class="col-md-8">
          <label class="form-label fw-semibold">C√≥digo de Refer√™ncia</label>
          <input
            type="text"
            name="codigo_referencia"
            class="form-control"
            placeholder="Ex: BR_RJANRIO_R0_TESTE001"
            value="{{ codigo or '' }}"
            required
          >
          <div class="form-text">
            A busca n√£o diferencia letras mai√∫sculas e min√∫sculas.
          </div>
        </div>

        <div class="col-md-4">
          <button type="submit" class="btn btn-success w-90">
            üîç Buscar
          </button>
        </div>
      </form>

      <hr class="my-4">

      <!-- ‚úÖ Resultado da busca -->
      {% if registro %}
        <div class="alert alert-success d-flex justify-content-between align-items-center">
          <div>
            ‚úÖ C√≥digo encontrado: <strong>{{ registro.codigo_referencia }}</strong>
          </div>

          <a href="{{ url_for('editar_registro', id=registro.id) }}" class="btn btn-outline-warning btn-sm">
            ‚úèÔ∏è Editar registro
          </a>
        </div>

        <!-- (Opcional) resumo do registro encontrado -->
        <div class="table-responsive">
          <table class="table table-sm table-bordered align-middle mb-0">
            <tbody>
              <tr>
                <th style="width: 220px;">ID</th>
                <td>{{ registro.id }}</td>
              </tr>
              <tr>
                <th>T√≠tulo / Conte√∫do</th>
                <td>{{ registro.titulo_conteudo or '' }}</td>
              </tr>
              <tr>
                <th>Divis√£o</th>
                <td>{{ registro.divisao or '' }}</td>
              </tr>
              <tr>
                <th>Localizado?</th>
                <td>
                  {% if registro.localizado %}
                    <span class="badge bg-success">Encontrado</span>
                  {% else %}
                    <span class="badge bg-danger">N√£o encontrado</span>
                  {% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      {% elif nao_encontrado and codigo %}
        <div class="alert alert-warning d-flex justify-content-between align-items-center">
          <div>
            ‚ùå C√≥digo n√£o encontrado: <strong>{{ codigo }}</strong>
          </div>

          <!-- ‚úÖ bot√£o novo: cria registro com o c√≥digo j√° preenchido -->
          <a class="btn btn-success btn-sm"
             href="{{ url_for('inserir_dados') }}?codigo={{ codigo|urlencode }}">
            ‚ûï Inserir novo registro
          </a>
        </div>

        <div class="text-muted">
          Dica: ao abrir a tela de inser√ß√£o, o c√≥digo j√° vai vir preenchido automaticamente.
        </div>
      {% else %}
        <div class="alert alert-secondary mb-0">
          Fa√ßa a busca para verificar se o c√≥digo j√° existe.
        </div>
      {% endif %}

      <hr class="my-4">

      <div class="d-flex gap-2">
        <a href="{{ url_for('home') }}" class="btn btn-outline-secondary">
          ‚¨ÖÔ∏è Voltar para Home
        </a>

        <a href="{{ url_for('pesquisar_divisao') }}" class="btn btn-outline-primary">
          üìÅ Pesquisar por Divis√£o
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
